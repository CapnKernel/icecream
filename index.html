

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Welcome to the Django icecream tutorial! &mdash; icecream 0.1 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="icecream 0.1 documentation" href="#" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li><a href="#">icecream 0.1 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="welcome-to-the-django-icecream-tutorial">
<h1>Welcome to the Django icecream tutorial!<a class="headerlink" href="#welcome-to-the-django-icecream-tutorial" title="Permalink to this headline">¶</a></h1>
</div>
<div class="section" id="getting-started">
<h1>Getting started<a class="headerlink" href="#getting-started" title="Permalink to this headline">¶</a></h1>
<p>This tutorial is for those who want to learn more about Django.  If you&#8217;ve just finished the official Django tutorial and want to consolidate what you&#8217;ve learned, plus see a few more things, read away.</p>
<p>By using the example of an app to manage the inventory of icecream flavours in a cafe, this tutorial shows an example of how to write &#8216;CRUD&#8217; apps: Apps that can create, read, update and delete objects.</p>
<p>One presentation difference is that code changes in this tutorial are presented in the form of diffs.  This shows you exactly the changes to make to the code: What lines should be removed, and what lines should be added.</p>
<p>If you&#8217;re using Linux, or you have Cygwin installed, you can start a shell and run this command:</p>
<div class="highlight-bash"><div class="highlight"><pre>patch -p0
</pre></div>
</div>
<p>Then copy-and-paste the diff into the terminal, and press Ctrl-D twice.  The patch program will automatically apply this change.</p>
<div class="toctree-wrapper compound">
<ul class="simple">
</ul>
</div>
</div>
<div class="section" id="tutorial">
<h1>Tutorial<a class="headerlink" href="#tutorial" title="Permalink to this headline">¶</a></h1>
<div class="section" id="creating-the-project">
<h2>Creating the project<a class="headerlink" href="#creating-the-project" title="Permalink to this headline">¶</a></h2>
<p>By now you should be familiar with how to create a Django project.  Let&#8217;s create a project called &#8220;cafe&#8221;:</p>
<div class="highlight-bash"><div class="highlight"><pre>django-admin.py startproject cafe
</pre></div>
</div>
<p>As with the original tutorial, you should be able to start the Django development server and verify that the project has been created correctly:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nb">cd </span>cafe
python manage.py runserver
Validating models...

0 errors found
July 4, 1776 - 15:50:53
Django version 1.4, using settings <span class="s1">&#39;mysite.settings&#39;</span>
Starting development server at http://127.0.0.1:8000/
Quit the server with CONTROL-C.
</pre></div>
</div>
<p>Visiting <a class="reference external" href="http://127.0.0.1:8000/">http://127.0.0.1:8000/</a> should then display the pastel-blue Django welcome page.</p>
<p>Now that you&#8217;ve verified the project and server are working, go ahead and set up a local sqlite database:</p>
<div class="highlight-diff"><div class="highlight"><pre><span class="gh">diff --git cafe-old/settings.py cafe/settings.py</span>
<span class="gd">--- cafe-old/settings.py</span>
<span class="gi">+++ cafe/settings.py</span>
<span class="gu">@@ -11,8 +11,8 @@ MANAGERS = ADMINS</span>

 DATABASES = {
     &#39;default&#39;: {
<span class="gd">-        &#39;ENGINE&#39;: &#39;django.db.backends.&#39;, # Add &#39;postgresql_psycopg2&#39;, &#39;mysql&#39;, &#39;sqlite3&#39; or &#39;oracle&#39;.</span>
<span class="gd">-        &#39;NAME&#39;: &#39;&#39;,                      # Or path to database file if using sqlite3.</span>
<span class="gi">+        &#39;ENGINE&#39;: &#39;django.db.backends.sqlite3&#39;, # Add &#39;postgresql_psycopg2&#39;, &#39;mysql&#39;, &#39;sqlite3&#39; or &#39;oracle&#39;.</span>
<span class="gi">+        &#39;NAME&#39;: &#39;cafe.sqlite&#39;,                      # Or path to database file if using sqlite3.</span>
         &#39;USER&#39;: &#39;&#39;,                      # Not used with sqlite3.
         &#39;PASSWORD&#39;: &#39;&#39;,                  # Not used with sqlite3.
         &#39;HOST&#39;: &#39;&#39;,                      # Set to empty string for 127.0.0.1. Not used with sqlite3.
</pre></div>
</div>
<p>And create this initial database:</p>
<div class="highlight-bash"><div class="highlight"><pre>python manage.py syncdb
</pre></div>
</div>
<p>Answer the questions, creating yourself an
Admin setup
&#8212;&#8212;&#8212;&#8211;</p>
<p>The admin functionality can be turned on and used even without defining any app models.  Make these changes:</p>
<div class="highlight-diff"><div class="highlight"><pre><span class="gh">diff -u cafe-old/settings.py cafe/settings.py</span>
<span class="gd">--- cafe-old/settings.py</span>
<span class="gi">+++ cafe/settings.py</span>
<span class="gu">@@ -116,7 +116,7 @@ INSTALLED_APPS = (</span>
     &#39;django.contrib.messages&#39;,
     &#39;django.contrib.staticfiles&#39;,
     # Uncomment the next line to enable the admin:
<span class="gd">-    # &#39;django.contrib.admin&#39;,</span>
<span class="gi">+    &#39;django.contrib.admin&#39;,</span>
     # Uncomment the next line to enable admin documentation:
     # &#39;django.contrib.admindocs&#39;,
 )
<span class="gh">diff -u cafe-old/urls.py cafe/urls.py</span>
<span class="gd">--- cafe-old/urls.py</span>
<span class="gi">+++ cafe/urls.py</span>
<span class="gu">@@ -1,8 +1,8 @@</span>
 from django.conf.urls import patterns, include, url

 # Uncomment the next two lines to enable the admin:
<span class="gd">-# from django.contrib import admin</span>
<span class="gd">-# admin.autodiscover()</span>
<span class="gi">+from django.contrib import admin</span>
<span class="gi">+admin.autodiscover()</span>

 urlpatterns = patterns(&#39;&#39;,
     # Examples:
<span class="gu">@@ -13,5 +13,5 @@ urlpatterns = patterns(&#39;&#39;,</span>
     # url(r&#39;^admin/doc/&#39;, include(&#39;django.contrib.admindocs.urls&#39;)),

     # Uncomment the next line to enable the admin:
<span class="gd">-    # url(r&#39;^admin/&#39;, include(admin.site.urls)),</span>
<span class="gi">+    url(r&#39;^admin/&#39;, include(admin.site.urls)),</span>
 )
</pre></div>
</div>
<p>Then try the admin interface here: <a class="reference external" href="http://127.0.0.1:8000/admin/">http://127.0.0.1:8000/admin/</a></p>
</div>
<div class="section" id="making-icecream">
<h2>Making icecream<a class="headerlink" href="#making-icecream" title="Permalink to this headline">¶</a></h2>
<p>Next, create an app called &#8220;icecream&#8221;.  This app could be used to track different flavours of icecream in a cafe, how much the icecream is sold for, and how much of each flavour is in stock.</p>
<div class="highlight-bash"><div class="highlight"><pre>python manage.py startapp icecream
</pre></div>
</div>
<p>After this, create a model to represent each flavour:</p>
<div class="highlight-diff"><div class="highlight"><pre><span class="gh">diff -u icecream-old/models.py icecream/models.py</span>
<span class="gd">--- icecream-old/models.py</span>
<span class="gi">+++ icecream/models.py</span>
<span class="gu">@@ -1,3 +1,11 @@</span>
 from django.db import models

 # Create your models here.
<span class="gi">+class Flavour(models.Model):</span>
<span class="gi">+    name = models.CharField(max_length=40)</span>
<span class="gi">+    litres = models.FloatField() # How many litres we have in the store</span>
<span class="gi">+    sellprice = models.DecimalField(decimal_places=2, max_digits=5) # How much it costs per litre</span>
<span class="gi">+</span>
<span class="gi">+    def __unicode__(self):</span>
<span class="gi">+        return self.name</span>
<span class="gi">+</span>
</pre></div>
</div>
<p>... and add the app to INSTALLED_APPS in the cafe/settings.py file:</p>
<div class="highlight-diff"><div class="highlight"><pre><span class="gh">diff -u cafe-old/settings.py cafe/settings.py</span>
<span class="gh">index 96061a2..079539d 100644</span>
<span class="gd">--- cafe-old/settings.py</span>
<span class="gi">+++ cafe/settings.py</span>
<span class="gu">@@ -119,6 +119,7 @@ INSTALLED_APPS = (</span>
     &#39;django.contrib.admin&#39;,
     # Uncomment the next line to enable admin documentation:
     # &#39;django.contrib.admindocs&#39;,
<span class="gi">+    &#39;icecream&#39;,</span>
 )

 # A sample logging configuration. The only tangible logging
</pre></div>
</div>
</div>
<div class="section" id="playing-with-flavours">
<h2>Playing with flavours<a class="headerlink" href="#playing-with-flavours" title="Permalink to this headline">¶</a></h2>
<p>Let&#8217;s have a look at the SQL statements to generate this model.  Run this:</p>
<div class="highlight-bash"><div class="highlight"><pre>python manage.py sqlall icecream
</pre></div>
</div>
<p>You should see this:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">BEGIN</span><span class="p">;</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="ss">&quot;icecream_flavour&quot;</span> <span class="p">(</span>
    <span class="ss">&quot;id&quot;</span> <span class="nb">integer</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
    <span class="ss">&quot;name&quot;</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">40</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="ss">&quot;litres&quot;</span> <span class="nb">real</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="ss">&quot;sellprice&quot;</span> <span class="nb">decimal</span> <span class="k">NOT</span> <span class="k">NULL</span>
<span class="p">)</span>
<span class="p">;</span>
<span class="k">COMMIT</span><span class="p">;</span>
</pre></div>
</div>
<p>Now create the table, and enter the database shell:</p>
<div class="highlight-bash"><div class="highlight"><pre>python manage.py syncdb
python manage.py dbshell
</pre></div>
</div>
<p>You can now look at the schema, and enter a test flavour:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="p">.</span><span class="n">tables</span>
<span class="p">.</span><span class="k">schema</span> <span class="n">icecream_flavour</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">icecream_flavour</span> <span class="k">values</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="ss">&quot;Chocolate&quot;</span><span class="p">,</span> <span class="ss">&quot;70&quot;</span><span class="p">,</span> <span class="ss">&quot;55&quot;</span><span class="p">);</span>
<span class="p">.</span><span class="n">exit</span>
</pre></div>
</div>
<p>Cool!  Now we can play with the model instances from within Django.  Run <tt class="docutils literal"><span class="pre">python</span> <span class="pre">manage.py</span> <span class="pre">shell</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">icecream.models</span> <span class="kn">import</span> <span class="n">Flavour</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">Flavour</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="go">[&lt;Flavour: Chocolate&gt;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">Flavour</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<span class="go">Chocolate</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">choc</span> <span class="o">=</span> <span class="n">Flavour</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">choc</span>
<span class="go">Chocolate</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">choc</span><span class="o">.</span><span class="n">litres</span>
<span class="go">70.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">choc</span><span class="o">.</span><span class="n">litres</span> <span class="o">=</span> <span class="mi">80</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">choc</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">choc</span><span class="o">.</span><span class="n">litres</span>
<span class="go">80</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">lemon</span> <span class="o">=</span> <span class="n">Flavour</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;Lemon&quot;</span><span class="p">,</span> <span class="n">litres</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">sellprice</span><span class="o">=</span><span class="mi">40</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">lemon</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">Flavour</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<span class="go">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">Flavour</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="go">[&lt;Flavour: Chocolate&gt;, &lt;Flavour: Lemon&gt;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">exit</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="flavours-in-admin">
<h2>Flavours in admin<a class="headerlink" href="#flavours-in-admin" title="Permalink to this headline">¶</a></h2>
<p>We can show the Flavour model in the admin interface:</p>
<div class="highlight-diff"><div class="highlight"><pre><span class="gh">diff -u icecream-old/admin.py icecream/admin.py</span>
<span class="gd">--- /dev/null</span>
<span class="gi">+++ icecream/admin.py</span>
<span class="gu">@@ -0,0 +1,4 @@</span>
<span class="gi">+from django.contrib import admin</span>
<span class="gi">+from icecream.models import Flavour</span>
<span class="gi">+</span>
<span class="gi">+admin.site.register(Flavour)</span>
</pre></div>
</div>
<p>Try viewing the admin interface now.  You should see the Flavour model in the Icecream app.</p>
<p>Click on <tt class="docutils literal"><span class="pre">Flavours</span></tt>.  Hmm, wouldn&#8217;t it be better if we could display something more than just the flavour name?  Let&#8217;s add some fields:</p>
<div class="highlight-diff"><div class="highlight"><pre><span class="gh">diff -u icecream-old/admin.py icecream/admin.py</span>
<span class="gd">--- icecream-old/admin.py</span>
<span class="gi">+++ icecream/admin.py</span>
<span class="gu">@@ -1,4 +1,9 @@</span>
 from django.contrib import admin
 from icecream.models import Flavour

<span class="gd">-admin.site.register(Flavour)</span>
<span class="gi">+# Override fields and ordering of fields</span>
<span class="gi">+class FlavourAdmin(admin.ModelAdmin):</span>
<span class="gi">+    fields = [&#39;name&#39;, &#39;litres&#39;, &#39;sellprice&#39;]</span>
<span class="gi">+    list_display = (&#39;name&#39;, &#39;litres&#39;, &#39;sellprice&#39;)</span>
<span class="gi">+</span>
<span class="gi">+admin.site.register(Flavour, FlavourAdmin)</span>
</pre></div>
</div>
<p>Try the admin interface now.  Enjoy the extra fields!</p>
</div>
<div class="section" id="crud-is-create-read-update-and-delete">
<h2>CRUD is Create, Read, Update and Delete<a class="headerlink" href="#crud-is-create-read-update-and-delete" title="Permalink to this headline">¶</a></h2>
<p>The basic operations on data are to create something, to be able to view it, to edit it, and to delete it.  Django&#8217;s ORM model system can do these just fine, but the tutorial is missing some details about Django&#8217;s way of doing this in web apps.  Our demo is going to show how all these operations can be done.</p>
<p>One note about GET and POST.  As well as a different way to pass data from the web client to the server, it&#8217;s a common pattern in Django to be able to make both GET and POST requests to the same URL, but the meaning of these requests is somewhat different:</p>
<blockquote>
<div><ul>
<li><p class="first">GET requests are for requests which don&#8217;t change anything.  Within the view for a CRUD-type operation, a GET request is often used to send the data the operation relates to, back to the web browser for the user to review.  It shouldn&#8217;t matter how many times a request is made.</p>
</li>
<li><p class="first">POST requests are for requests which change something.  For views of CRUD operations, a POST request is often used to actually <em>do</em> the CRUD operation.  (If there are multiple actions that could be done with a view, often some sort of &#8220;action&#8221; parameter is passed back to the view, so the view knows which action to take).</p>
<p>As mentioned in the official tutorial, standard practice is to redirect a successful POST request to a GET.  That can prevent lots of problems with browsers trying to replay old operations when pages are refreshed.</p>
</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="url-and-view-design">
<h2>URL and view design<a class="headerlink" href="#url-and-view-design" title="Permalink to this headline">¶</a></h2>
<p>Often the first step when coding a Django app is to plan our URLs and views.  For each of the CRUD operations on our Flavour models, here are some URLs and view names:</p>
<table border="1" class="docutils">
<colgroup>
<col width="16%" />
<col width="37%" />
<col width="47%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Operation</td>
<td>URL</td>
<td>view</td>
</tr>
<tr class="row-even"><td>Read (list)</td>
<td><tt class="docutils literal"><span class="pre">^flavour/$</span></tt></td>
<td><tt class="docutils literal"><span class="pre">icecream.views.flavours</span></tt></td>
</tr>
<tr class="row-odd"><td>Create</td>
<td><tt class="docutils literal"><span class="pre">^flavour/add/$</span></tt></td>
<td><tt class="docutils literal"><span class="pre">icecream.views.flavour_add</span></tt></td>
</tr>
<tr class="row-even"><td>Read/update</td>
<td><tt class="docutils literal"><span class="pre">^flavour/&lt;id&gt;/$</span></tt></td>
<td><tt class="docutils literal"><span class="pre">icecream.views.flavour_edit</span></tt></td>
</tr>
<tr class="row-odd"><td>Delete</td>
<td><tt class="docutils literal"><span class="pre">^flavour/&lt;id&gt;/delete/$</span></tt></td>
<td><tt class="docutils literal"><span class="pre">icecream.views.flavour_delete</span></tt></td>
</tr>
</tbody>
</table>
<p>Note that we&#8217;re offering two kinds of read: A list of all flavours, and a page for each flavour which shows flavour details, as well as lets us edit those details.</p>
<p>For each of these operations on our flavours, let&#8217;s add a URL, and a stubbed out view:</p>
<div class="highlight-diff"><div class="highlight"><pre><span class="gh">diff -u cafe-old/urls.py cafe/urls.py</span>
<span class="gd">--- cafe-old/urls.py</span>
<span class="gi">+++ cafe/urls.py</span>
<span class="gu">@@ -7,7 +7,7 @@ admin.autodiscover()</span>
 urlpatterns = patterns(&#39;&#39;,
     # Examples:
     # url(r&#39;^$&#39;, &#39;cafe.views.home&#39;, name=&#39;home&#39;),
<span class="gd">-    # url(r&#39;^cafe/&#39;, include(&#39;cafe.foo.urls&#39;)),</span>
<span class="gi">+    url(r&#39;^icecream/&#39;, include(&#39;icecream.urls&#39;)),</span>

     # Uncomment the admin/doc line below to enable admin documentation:
     # url(r&#39;^admin/doc/&#39;, include(&#39;django.contrib.admindocs.urls&#39;)),
<span class="gh">diff -u icecream-old/urls.py icecream/urls.py</span>
<span class="gd">--- /dev/null</span>
<span class="gi">+++ icecream/urls.py</span>
<span class="gu">@@ -0,0 +1,10 @@</span>
<span class="gi">+from django.conf.urls import patterns, url</span>
<span class="gi">+</span>
<span class="gi">+urlpatterns = patterns(&#39;icecream.views&#39;,</span>
<span class="gi">+    # Examples:</span>
<span class="gi">+    # url(r&#39;^$&#39;, &#39;cafe.views.home&#39;, name=&#39;home&#39;),</span>
<span class="gi">+    url(r&#39;^flavour/$&#39;, &#39;flavours&#39;),</span>
<span class="gi">+    url(r&#39;^flavour/add/$&#39;, &#39;flavour_add&#39;),</span>
<span class="gi">+    url(r&#39;^flavour/(?P&lt;id&gt;\d+)/$&#39;, &#39;flavour_edit&#39;),</span>
<span class="gi">+    url(r&#39;^flavour/(?P&lt;id&gt;\d+)/delete/$&#39;, &#39;flavour_delete&#39;),</span>
<span class="gi">+)</span>
<span class="gh">diff -u icecream-old/views.py icecream/views.py</span>
<span class="gd">--- icecream-old/views.py</span>
<span class="gi">+++ icecream/views.py</span>
<span class="gu">@@ -1 +1,15 @@</span>
<span class="gd">-# Create your views here.</span>
<span class="gi">+from django.shortcuts import Http404</span>
<span class="gi">+</span>
<span class="gi">+from icecream.models import Flavour</span>
<span class="gi">+</span>
<span class="gi">+def flavours(request):</span>
<span class="gi">+    raise Http404</span>
<span class="gi">+</span>
<span class="gi">+def flavour_add(request):</span>
<span class="gi">+    raise Http404</span>
<span class="gi">+</span>
<span class="gi">+def flavour_edit(request, id):</span>
<span class="gi">+    raise Http404</span>
<span class="gi">+</span>
<span class="gi">+def flavour_delete(request, id):</span>
<span class="gi">+    raise Http404</span>
</pre></div>
</div>
<p>When accessed, each view will throw an Http404 exception.  Note that this looks different to the HTTP 404 error when we browse to a URL that&#8217;s not listed in our urlconf.</p>
<p>Here&#8217;s a list of URLs to try.  Do they do what you expect?</p>
<blockquote>
<div><ul class="simple">
<li><a class="reference external" href="http://127.0.0.1:8000/icecream/">http://127.0.0.1:8000/icecream/</a></li>
<li><a class="reference external" href="http://127.0.0.1:8000/icecream/taste/">http://127.0.0.1:8000/icecream/taste/</a></li>
<li><a class="reference external" href="http://127.0.0.1:8000/icecream/flavour/">http://127.0.0.1:8000/icecream/flavour/</a></li>
<li><a class="reference external" href="http://127.0.0.1:8000/icecream/flavour/choc/">http://127.0.0.1:8000/icecream/flavour/choc/</a></li>
<li><a class="reference external" href="http://127.0.0.1:8000/icecream/flavour/1/">http://127.0.0.1:8000/icecream/flavour/1/</a></li>
<li><a class="reference external" href="http://127.0.0.1:8000/icecream/flavour/add/">http://127.0.0.1:8000/icecream/flavour/add/</a></li>
<li><a class="reference external" href="http://127.0.0.1:8000/icecream/flavour/1/delete/">http://127.0.0.1:8000/icecream/flavour/1/delete/</a></li>
</ul>
</div></blockquote>
</div>
<div class="section" id="show-a-list-of-flavours">
<h2>Show a list of flavours<a class="headerlink" href="#show-a-list-of-flavours" title="Permalink to this headline">¶</a></h2>
<p>Let&#8217;s add some view code to show the list of flavours:</p>
<div class="highlight-diff"><div class="highlight"><pre><span class="gh">diff -u icecream-old/views.py icecream/views.py</span>
<span class="gd">--- icecream-old/views.py</span>
<span class="gi">+++ icecream/views.py</span>
<span class="gu">@@ -1,9 +1,11 @@</span>
<span class="gi">+from django.shortcuts import render_to_response</span>
 from django.shortcuts import Http404

 from icecream.models import Flavour

 def flavours(request):
<span class="gd">-    raise Http404</span>
<span class="gi">+    flavours = Flavour.objects.all()</span>
<span class="gi">+    return render_to_response(&#39;icecream/flavours.html&#39;, {&#39;flavours&#39;: flavours})</span>

 def flavour_add(request):
     raise Http404
</pre></div>
</div>
<p>Let&#8217;s give this a spin at <a class="reference external" href="http://127.0.0.1:8000/icecream/flavour/">http://127.0.0.1:8000/icecream/flavour/</a>:</p>
<p>Oh no, there&#8217;s no template!  Let&#8217;s add one:</p>
<div class="highlight-diff"><div class="highlight"><pre><span class="gh">diff -u cafe-old/settings.py cafe/settings.py</span>
<span class="gd">--- cafe-old/settings.py</span>
<span class="gi">+++ cafe/settings.py</span>
<span class="gu">@@ -106,6 +106,7 @@ TEMPLATE_DIRS = (</span>
     # Put strings here, like &quot;/home/html/django_templates&quot; or &quot;C:/www/django/templates&quot;.
     # Always use forward slashes, even on Windows.
     # Don&#39;t forget to use absolute paths, not relative paths.
<span class="gi">+    &#39;templates&#39;,</span>
 )

 INSTALLED_APPS = (
<span class="gh">diff -u templates-old/icecream/flavours.html templates/icecream/flavours.html</span>
<span class="gd">--- /dev/null</span>
<span class="gi">+++ templates/icecream/flavours.html</span>
<span class="gu">@@ -0,0 +1,5 @@</span>
<span class="gi">+&lt;html&gt;</span>
<span class="gi">+&lt;body&gt;</span>
<span class="gi">+  &lt;p&gt;{{ flavours }}&lt;/p&gt;</span>
<span class="gi">+&lt;/body&gt;</span>
<span class="gi">+&lt;/html&gt;</span>
</pre></div>
</div>
<p>Now <a class="reference external" href="http://127.0.0.1:8000/icecream/flavour/">http://127.0.0.1:8000/icecream/flavour/</a> works.  Spend a moment to view the HTML source in your browser.</p>
<div class="admonition-do-we-really-need-an-absolute-path admonition">
<p class="first admonition-title">Do we really need an absolute path?</p>
<p class="last">Note that the <tt class="docutils literal"><span class="pre">settings.py</span></tt> file says &#8220;Don&#8217;t forget to use absolute paths, not relative paths&#8221;.  I&#8217;ve asked in the #django IRC channel, and it seems the only reason for using absolute paths is to guard against Django being run with an improperly set current directory.  However in general, relative paths like <tt class="docutils literal"><span class="pre">templates</span></tt> work just fine, and helps out a lot when you have multiple copies of your project, such as a development copy and a deployment copy.</p>
</div>
</div>
<div class="section" id="template-inheritance">
<h2>Template Inheritance<a class="headerlink" href="#template-inheritance" title="Permalink to this headline">¶</a></h2>
<p>Let&#8217;s break up this template into two parts, a base part (in <tt class="docutils literal"><span class="pre">templates/base.html</span></tt>) for things that all our web pages will share, and a part that&#8217;s specific to this view (<tt class="docutils literal"><span class="pre">templates/icecream/flavours.html</span></tt>):</p>
<div class="highlight-diff"><div class="highlight"><pre><span class="gh">diff -u templates-old/base.html templates/base.html</span>
<span class="gd">--- /dev/null</span>
<span class="gi">+++ templates/base.html</span>
<span class="gu">@@ -0,0 +1,14 @@</span>
<span class="gi">+&lt;!DOCTYPE HTML PUBLIC &quot;-//W3C/DTD HTML 4.01//EN&quot;&gt;</span>
<span class="gi">+&lt;html lang=&quot;en&quot;&gt;</span>
<span class="gi">+  &lt;head&gt;</span>
<span class="gi">+    &lt;title&gt;{% block title %}icecream.com: Nirvana for icecream lovers{% endblock %}&lt;/title&gt;</span>
<span class="gi">+  &lt;/head&gt;</span>
<span class="gi">+  &lt;body&gt;</span>
<span class="gi">+    &lt;h1&gt;{% block header %}Nirvana for icecream lovers{% endblock %}&lt;/h1&gt;</span>
<span class="gi">+    {% block content %}{% endblock %}</span>
<span class="gi">+    {% block footer %}</span>
<span class="gi">+    &lt;hr&gt;</span>
<span class="gi">+    &lt;p&gt;Don&#39;t you just love icecream?&lt;/p&gt;</span>
<span class="gi">+    {% endblock %}</span>
<span class="gi">+  &lt;/body&gt;</span>
<span class="gi">+&lt;/html&gt;</span>
<span class="gh">diff -u templates-old/icecream/flavours.html templates/icecream/flavours.html</span>
<span class="gd">--- templates-old/icecream/flavours.html</span>
<span class="gi">+++ templates/icecream/flavours.html</span>
<span class="gu">@@ -1,5 +1,10 @@</span>
<span class="gd">-&lt;html&gt;</span>
<span class="gd">-&lt;body&gt;</span>
<span class="gd">-  &lt;p&gt;{{ flavours }}&lt;/p&gt;</span>
<span class="gd">-&lt;/body&gt;</span>
<span class="gd">-&lt;/html&gt;</span>
<span class="gi">+{% extends &quot;base.html&quot; %}</span>
<span class="gi">+</span>
<span class="gi">+{% block header %}All the flavours{% endblock %}</span>
<span class="gi">+</span>
<span class="gi">+{% block content %}</span>
<span class="gi">+&lt;p&gt;A list of flavours:&lt;/p&gt;</span>
<span class="gi">+</span>
<span class="gi">+&lt;p&gt;{{ flavours }}&lt;/p&gt;</span>
<span class="gi">+</span>
<span class="gi">+{% endblock %}</span>
</pre></div>
</div>
<p>Notice how <tt class="docutils literal"><span class="pre">base.html</span></tt> has <tt class="docutils literal"><span class="pre">title</span></tt>, <tt class="docutils literal"><span class="pre">header</span></tt>, <tt class="docutils literal"><span class="pre">content</span></tt> and <tt class="docutils literal"><span class="pre">footer</span></tt> blocks, and that <tt class="docutils literal"><span class="pre">icecream/flavours.html</span></tt> overrides the values of the <tt class="docutils literal"><span class="pre">title</span></tt> and <tt class="docutils literal"><span class="pre">header</span></tt> blocks, provides a body to fill in the empty <tt class="docutils literal"><span class="pre">content</span></tt> block, but doesn&#8217;t override the <tt class="docutils literal"><span class="pre">footer</span></tt> block.</p>
</div>
<div class="section" id="fields-in-templates">
<h2>Fields in templates<a class="headerlink" href="#fields-in-templates" title="Permalink to this headline">¶</a></h2>
<p>At the moment our flavours page shows just flavour names.  It does this because the <tt class="docutils literal"><span class="pre">__unicode__</span></tt> helper method in the Flavours model returns the flavour name.  What about if we want to show more of the model in our template?</p>
<div class="highlight-diff"><div class="highlight"><pre><span class="gh">diff -u templates-old/icecream/flavours.html templates/icecream/flavours.html</span>
<span class="gd">--- templates-old/icecream/flavours.html</span>
<span class="gi">+++ templates/icecream/flavours.html</span>
<span class="gu">@@ -5,6 +5,10 @@</span>
 {% block content %}
 &lt;p&gt;A list of flavours:&lt;/p&gt;

<span class="gd">-&lt;p&gt;{{ flavours }}&lt;/p&gt;</span>
<span class="gi">+&lt;ul&gt;</span>
<span class="gi">+  {% for flavour in flavours %}</span>
<span class="gi">+  &lt;li&gt;{{ flavour.id }}: {{ flavour.name }}, {{ flavour.litres }}, {{ flavour.sellprice }}&lt;/li&gt;</span>
<span class="gi">+  {% endfor %}</span>
<span class="gi">+&lt;/ul&gt;</span>

 {% endblock %}
</pre></div>
</div>
<p>In addition to displaying the values of the model fields, we also have a for loop which iterates over the flavours, displaying them one line at a time in a list.</p>
</div>
<div class="section" id="conditionals-in-templates">
<h2>Conditionals in templates<a class="headerlink" href="#conditionals-in-templates" title="Permalink to this headline">¶</a></h2>
<p>The code in the previous section works fine except in the case where there are no flavours.  If that were to happen, we should tell our user what&#8217;s going on!</p>
<div class="highlight-diff"><div class="highlight"><pre><span class="gh">diff -u templates-old/icecream/flavours.html templates/icecream/flavours.html</span>
<span class="gd">--- templates-old/icecream/flavours.html</span>
<span class="gi">+++ templates/icecream/flavours.html</span>
<span class="gu">@@ -5,10 +5,14 @@</span>
 {% block content %}
 &lt;p&gt;A list of flavours:&lt;/p&gt;

<span class="gd">-&lt;ul&gt;</span>
<span class="gd">-  {% for flavour in flavours %}</span>
<span class="gd">-  &lt;li&gt;{{ flavour.id }}: {{ flavour.name }}, {{ flavour.litres }}, {{ flavour.sellprice }}&lt;/li&gt;</span>
<span class="gd">-  {% endfor %}</span>
<span class="gd">-&lt;/ul&gt;</span>
<span class="gi">+{% if flavours %}</span>
<span class="gi">+  &lt;ul&gt;</span>
<span class="gi">+    {% for flavour in flavours %}</span>
<span class="gi">+    &lt;li&gt;{{ flavour.id }}: {{ flavour.name }}, {{ flavour.litres }}, {{ flavour.sellprice }}&lt;/li&gt;</span>
<span class="gi">+    {% endfor %}</span>
<span class="gi">+  &lt;/ul&gt;</span>
<span class="gi">+{% else %}</span>
<span class="gi">+  &lt;p&gt;Quick, better add some flavours before customers arrive!&lt;/p&gt;</span>
<span class="gi">+{% endif %}</span>

 {% endblock %}
</pre></div>
</div>
<p>If there are no flavours, we now tell our user what&#8217;s going on.</p>
</div>
<div class="section" id="adding-an-add-link">
<h2>Adding an &#8216;Add&#8217; link<a class="headerlink" href="#adding-an-add-link" title="Permalink to this headline">¶</a></h2>
<p>In the case where there are no flavours (or more are needed), how can the user add them?  One way is by using the admin interface.  The other way is to improve our app to do it.</p>
<p>Let&#8217;s give them an &#8220;Add&#8221; link:</p>
<div class="highlight-diff"><div class="highlight"><pre><span class="gh">diff -u templates-old/icecream/flavours.html templates/icecream/flavours.html</span>
<span class="gd">--- templates-old/icecream/flavours.html</span>
<span class="gi">+++ templates/icecream/flavours.html</span>
<span class="gu">@@ -15,4 +15,6 @@</span>
   &lt;p&gt;Quick, better add some flavours before customers arrive!&lt;/p&gt;
 {% endif %}

<span class="gi">+&lt;p&gt;&lt;a href=&quot;http://localhost:8000/icecream/flavour/add/&quot;&gt;Add&lt;/a&gt; a new flavour.&lt;/p&gt;</span>
<span class="gi">+</span>
 {% endblock %}
</pre></div>
</div>
<p>You can click on the &#8216;Add&#8217; link, but you&#8217;ll get a 404 error message, because that&#8217;s all our <tt class="docutils literal"><span class="pre">flavour_add</span></tt> view knows what to do.</p>
<p>This is the first step to adding the &#8220;create&#8221; part of CRUD.</p>
</div>
<div class="section" id="using-the-url-tag">
<h2>Using the <tt class="docutils literal"><span class="pre">url</span></tt> tag<a class="headerlink" href="#using-the-url-tag" title="Permalink to this headline">¶</a></h2>
<p>The problem with the previous change is that it&#8217;s hardwired to a particular address.  If we were to change the urlconf to have flavour addition on a different URL, or we deployed this app on another port or machine, then this link would stop working.  In order to prevent this, we can use the <tt class="docutils literal"><span class="pre">url</span></tt> template tag to generate the URL from the name of the view.  (If we had named the url pattern, we could also use this name).</p>
<div class="highlight-diff"><div class="highlight"><pre><span class="gh">diff -u templates-old/icecream/flavours.html templates/icecream/flavours.html</span>
<span class="gd">--- templates-old/icecream/flavours.html</span>
<span class="gi">+++ templates/icecream/flavours.html</span>
<span class="gu">@@ -1,4 +1,5 @@</span>
 {% extends &quot;base.html&quot; %}
<span class="gi">+{% load url from future %}</span>

 {% block header %}All the flavours{% endblock %}

<span class="gu">@@ -15,6 +16,6 @@</span>
   &lt;p&gt;Quick, better add some flavours before customers arrive!&lt;/p&gt;
 {% endif %}

<span class="gd">-&lt;p&gt;&lt;a href=&quot;http://localhost:8000/icecream/flavour/add/&quot;&gt;Add&lt;/a&gt; a new flavour.&lt;/p&gt;</span>
<span class="gi">+&lt;p&gt;&lt;a href=&quot;{% url &#39;icecream.views.flavour_add&#39; %}&quot;&gt;Add&lt;/a&gt; a new flavour.&lt;/p&gt;</span>

 {% endblock %}
</pre></div>
</div>
</div>
<div class="section" id="adding-an-add-form-and-view">
<h2>Adding an &#8220;Add&#8221; form and view<a class="headerlink" href="#adding-an-add-form-and-view" title="Permalink to this headline">¶</a></h2>
<p>I
Now that our flavour adding link is in place, let&#8217;s work on the view to handle adding a flavour, and the template to display a form to accept the flavour details:</p>
<div class="highlight-diff"><div class="highlight"><pre><span class="gh">diff -u icecream-old/views.py icecream/views.py</span>
<span class="gd">--- icecream-old/views.py</span>
<span class="gi">+++ icecream/views.py</span>
<span class="gu">@@ -8,7 +8,7 @@ def flavours(request):</span>
     return render_to_response(&#39;icecream/flavours.html&#39;, {&#39;flavours&#39;: flavours})

 def flavour_add(request):
<span class="gd">-    raise Http404</span>
<span class="gi">+    return render_to_response(&#39;icecream/flavour-add.html&#39;)</span>

 def flavour_edit(request, id):
     raise Http404
<span class="gh">diff -u templates-old/icecream/flavour-add.html templates/icecream/flavour-add.html</span>
<span class="gd">--- /dev/null</span>
<span class="gi">+++ templates/icecream/flavour-add.html</span>
<span class="gu">@@ -0,0 +1,14 @@</span>
<span class="gi">+{% extends &quot;base.html&quot; %}</span>
<span class="gi">+{% block header %}All the flavours - Add a flavour{% endblock %}</span>
<span class="gi">+{% block content %}</span>
<span class="gi">+&lt;p&gt;Add a flavour:&lt;/p&gt;</span>
<span class="gi">+</span>
<span class="gi">+&lt;form method=&quot;POST&quot;&gt;</span>
<span class="gi">+  &lt;p&gt;Name: &lt;input type=&quot;text&quot; name=&quot;name&quot; value=&quot;&quot; /&gt;&lt;/p&gt;</span>
<span class="gi">+  &lt;p&gt;Litres: &lt;input type=&quot;text&quot; name=&quot;litres&quot; value=&quot;&quot; /&gt;&lt;/p&gt;</span>
<span class="gi">+  &lt;p&gt;Selling price: &lt;input type=&quot;text&quot; name=&quot;sellprice&quot; value=&quot;&quot; /&gt;&lt;/p&gt;</span>
<span class="gi">+  &lt;p&gt;&lt;input type=&quot;submit&quot; value=&quot;Add&quot; /&gt;&lt;/p&gt;</span>
<span class="gi">+&lt;/form&gt;</span>
<span class="gi">+</span>
<span class="gi">+&lt;p&gt;&lt;a href=&quot;..&quot;&gt;Back&lt;/a&gt;&lt;/p&gt;</span>
<span class="gi">+{% endblock %}</span>
</pre></div>
</div>
<p>Clicking on <a class="reference external" href="http://127.0.0.1:8000/icecream/flavour/add">http://127.0.0.1:8000/icecream/flavour/add</a> no longer gives a 404.  A nice form comes up, and we can enter new flavour details, click on &#8220;Add&#8221; and... <em>uh-oh</em>, a warning that the verification done as part of CSRF attack prevention has failed.</p>
</div>
<div class="section" id="csrf-and-adding-flavours">
<h2>CSRF and adding flavours<a class="headerlink" href="#csrf-and-adding-flavours" title="Permalink to this headline">¶</a></h2>
<p>Django can help prevent against CSRF attacks, but it needs our help.  We need to add <tt class="docutils literal"><span class="pre">{{</span> <span class="pre">csrf_token</span> <span class="pre">}}</span></tt> to the body of the form.  This is a variable with a magic value that will be sent back to the server when we submit the form.  We also need to convert our <tt class="docutils literal"><span class="pre">request</span></tt> argument into a <tt class="docutils literal"><span class="pre">RequestContext</span></tt>, and pass this to <tt class="docutils literal"><span class="pre">render_to_response()</span></tt> as the <tt class="docutils literal"><span class="pre">context_instance</span></tt> kwarg.</p>
<p>This change also adds code to create a new model instance from the form data, and save it to the database.</p>
<div class="highlight-diff"><div class="highlight"><pre><span class="gh">diff -u templates-old/icecream/flavour-add.html templates/icecream/flavour-add.html</span>
<span class="gd">--- templates-old/icecream/flavour-add.html</span>
<span class="gi">+++ templates/icecream/flavour-add.html</span>
<span class="gu">@@ -4,6 +4,7 @@</span>
 &lt;p&gt;Add a flavour:&lt;/p&gt;

 &lt;form method=&quot;POST&quot;&gt;
<span class="gi">+  {% csrf_token %}</span>
   &lt;p&gt;Name: &lt;input type=&quot;text&quot; name=&quot;name&quot; value=&quot;&quot; /&gt;&lt;/p&gt;
   &lt;p&gt;Litres: &lt;input type=&quot;text&quot; name=&quot;litres&quot; value=&quot;&quot; /&gt;&lt;/p&gt;
   &lt;p&gt;Selling price: &lt;input type=&quot;text&quot; name=&quot;sellprice&quot; value=&quot;&quot; /&gt;&lt;/p&gt;
<span class="gh">diff -u icecream-old/views.py icecream/views.py</span>
<span class="gd">--- icecream-old/views.py</span>
<span class="gi">+++ icecream/views.py</span>
<span class="gu">@@ -1,5 +1,8 @@</span>
 from django.shortcuts import render_to_response
 from django.shortcuts import Http404
<span class="gi">+from django.template import RequestContext</span>
<span class="gi">+from django.http import HttpResponseRedirect</span>
<span class="gi">+from django.core.urlresolvers import reverse</span>

 from icecream.models import Flavour

<span class="gu">@@ -8,7 +11,17 @@ def flavours(request):</span>
     return render_to_response(&#39;icecream/flavours.html&#39;, {&#39;flavours&#39;: flavours})

 def flavour_add(request):
<span class="gd">-    return render_to_response(&#39;icecream/flavour-add.html&#39;)</span>
<span class="gi">+    if request.method == &#39;POST&#39;:</span>
<span class="gi">+        flavour = Flavour()</span>
<span class="gi">+        flavour.name = request.POST[&#39;name&#39;]</span>
<span class="gi">+        flavour.litres = request.POST[&#39;litres&#39;]</span>
<span class="gi">+        flavour.sellprice = request.POST[&#39;sellprice&#39;]</span>
<span class="gi">+</span>
<span class="gi">+        flavour.save()</span>
<span class="gi">+</span>
<span class="gi">+        return HttpResponseRedirect(reverse(&#39;icecream.views.flavours&#39;)) # Redirect after POST</span>
<span class="gi">+</span>
<span class="gi">+    return render_to_response(&#39;icecream/flavour-add.html&#39;, {}, context_instance=RequestContext(request))</span>

 def flavour_edit(request, id):
     raise Http404
</pre></div>
</div>
<p>If this view is called as the result of a GET request, we render and return the flavour form.  However if this view is called as the result of a POST form, we create a new <tt class="docutils literal"><span class="pre">Flavour</span></tt> instance, set the field values from the POST data, then save it to the database.  Finally, we redirect the user back to the main flavours page.  Similar to the <tt class="docutils literal"><span class="pre">url</span></tt> template tag, we use the <tt class="docutils literal"><span class="pre">reverse</span></tt> function to avoid hard-coding a URL into the redirection.</p>
<p>Does adding flavours work now?  And what about if you enter invalid data, such as &#8220;xyz&#8221; for litres?  At present, our code doesn&#8217;t do any field validation.  We&#8217;ll add that later.</p>
</div>
<div class="section" id="adding-delete">
<h2>Adding delete<a class="headerlink" href="#adding-delete" title="Permalink to this headline">¶</a></h2>
<p>The next CRUD operation to look at is delete.  In some ways this is similar to adding: We&#8217;re using both GET and POST requests, with the GET request displaying a confirmation message, and the POST request triggering flavour deletion:</p>
<div class="highlight-diff"><div class="highlight"><pre><span class="gh">diff -u icecream-old/views.py icecream/views.py</span>
<span class="gd">--- icecream-old/views.py</span>
<span class="gi">+++ icecream/views.py</span>
<span class="gu">@@ -1,4 +1,4 @@</span>
<span class="gd">-from django.shortcuts import render_to_response</span>
<span class="gi">+from django.shortcuts import render_to_response, get_object_or_404</span>
 from django.shortcuts import Http404
 from django.template import RequestContext
 from django.http import HttpResponseRedirect
<span class="gu">@@ -27,4 +27,13 @@ def flavour_edit(request, id):</span>
     raise Http404

 def flavour_delete(request, id):
<span class="gd">-    raise Http404</span>
<span class="gi">+    # GET: Prompt for whether to delete a flavour</span>
<span class="gi">+    # POST: Delete the address and redirect to flavours</span>
<span class="gi">+    flavour = get_object_or_404(Flavour, pk=id)</span>
<span class="gi">+</span>
<span class="gi">+    if request.method == &#39;POST&#39;:</span>
<span class="gi">+        flavour.delete()</span>
<span class="gi">+</span>
<span class="gi">+        return HttpResponseRedirect(reverse(&#39;icecream.views.flavours&#39;))</span>
<span class="gi">+</span>
<span class="gi">+    return render_to_response(&#39;icecream/flavour-delete.html&#39;, {&#39;flavour&#39;: flavour}, context_instance=RequestContext(request))</span>
<span class="gh">diff -u templates-old/icecream/flavour-delete.html templates/icecream/flavour-delete.html</span>
<span class="gd">--- /dev/null</span>
<span class="gi">+++ templates/icecream/flavour-delete.html</span>
<span class="gu">@@ -0,0 +1,17 @@</span>
<span class="gi">+{% extends &quot;base.html&quot; %}</span>
<span class="gi">+{% block header %}All the flavours - Delete a flavour{% endblock %}</span>
<span class="gi">+{% block content %}</span>
<span class="gi">+&lt;p&gt;Delete a flavour:&lt;/p&gt;</span>
<span class="gi">+</span>
<span class="gi">+&lt;p&gt;{{ flavour }}:&lt;/p&gt;</span>
<span class="gi">+</span>
<span class="gi">+&lt;p&gt; Really delete?&lt;/p&gt;</span>
<span class="gi">+</span>
<span class="gi">+&lt;form method=&quot;POST&quot;&gt;</span>
<span class="gi">+  {% csrf_token %}</span>
<span class="gi">+  &lt;input type=&quot;submit&quot; value=&quot;Delete&quot; /&gt;</span>
<span class="gi">+&lt;/form&gt;</span>
<span class="gi">+</span>
<span class="gi">+&lt;p&gt;&lt;a href=&quot;..&quot;&gt;Back&lt;/a&gt;&lt;/p&gt;</span>
<span class="gi">+{% endblock %}</span>
<span class="gi">+</span>
</pre></div>
</div>
<p>This time however, the operation uses the <tt class="docutils literal"><span class="pre">get_object_or_404()</span></tt> helper function to find the model instance to delete (for POST requests), and to send to the form (for GET requests).</p>
<div class="admonition-primary-key-names admonition">
<p class="first admonition-title">Primary key names</p>
<p class="last">Relational database tables usually have a primary key column.  It often contains an integer which uniquely identifies the rows in the table.  If your model definition doesn&#8217;t specify a primary key, a primary key called <tt class="docutils literal"><span class="pre">id</span></tt> will be created for you.  So in general, primary keys will be called <tt class="docutils literal"><span class="pre">id</span></tt>.  When using <tt class="docutils literal"><span class="pre">get_object_or_404()</span></tt>, it&#8217;s tempting to look up the model instance using <tt class="docutils literal"><span class="pre">id</span></tt>, however we can&#8217;t always guarantee that <tt class="docutils literal"><span class="pre">id</span></tt> exists.  For this reason, we use <tt class="docutils literal"><span class="pre">pk</span></tt>, for &#8220;primary key&#8221;.  Django will map <tt class="docutils literal"><span class="pre">pk</span></tt> onto the primary key field for the model.</p>
</div>
<p>At the moment, we don&#8217;t have a way of clicking to the delete view.  We&#8217;ll add that next.  For the moment, you can get the page by entering the URL by hand, for example, <a class="reference external" href="http://127.0.0.1/icecream/flavours/1/delete">http://127.0.0.1/icecream/flavours/1/delete</a></p>
<p>Try it out.  Does it work?</p>
</div>
<div class="section" id="editing-flavours">
<h2>Editing flavours<a class="headerlink" href="#editing-flavours" title="Permalink to this headline">¶</a></h2>
<p>Now onto the final CRUD operation: updating.  (Since we&#8217;ve now got code for all four of our views, we can remove the Http404 exception).</p>
<div class="highlight-diff"><div class="highlight"><pre><span class="gh">diff -u icecream-old/views.py icecream/views.py</span>
<span class="gd">--- icecream-old/views.py</span>
<span class="gi">+++ icecream/views.py</span>
<span class="gu">@@ -1,5 +1,4 @@</span>
 from django.shortcuts import render_to_response, get_object_or_404
<span class="gd">-from django.shortcuts import Http404</span>
 from django.template import RequestContext
 from django.http import HttpResponseRedirect
 from django.core.urlresolvers import reverse
<span class="gu">@@ -24,7 +23,16 @@ def flavour_add(request):</span>
     return render_to_response(&#39;icecream/flavour-add.html&#39;, {}, context_instance=RequestContext(request))

 def flavour_edit(request, id):
<span class="gd">-    raise Http404</span>
<span class="gi">+    flavour = get_object_or_404(Flavour, pk=id)</span>
<span class="gi">+    if request.method == &#39;POST&#39;:</span>
<span class="gi">+        flavour.name = request.POST[&#39;name&#39;]</span>
<span class="gi">+        flavour.litres = request.POST[&#39;litres&#39;]</span>
<span class="gi">+        flavour.sellprice = request.POST[&#39;sellprice&#39;]</span>
<span class="gi">+        flavour.save()</span>
<span class="gi">+</span>
<span class="gi">+        return HttpResponseRedirect(reverse(&#39;icecream.views.flavours&#39;))</span>
<span class="gi">+</span>
<span class="gi">+    return render_to_response(&#39;icecream/flavour-edit.html&#39;, {&#39;flavour&#39;: flavour}, context_instance=RequestContext(request))</span>

 def flavour_delete(request, id):
     # GET: Prompt for whether to delete a flavour
<span class="gh">diff -u templates-old/icecream/flavour-edit.html templates/icecream/flavour-edit.html</span>
<span class="gd">--- /dev/null</span>
<span class="gi">+++ templates/icecream/flavour-edit.html</span>
<span class="gu">@@ -0,0 +1,19 @@</span>
<span class="gi">+{% extends &quot;base.html&quot; %}</span>
<span class="gi">+{% load url from future %}</span>
<span class="gi">+{% block header %}All the flavours - Edit a flavour{% endblock %}</span>
<span class="gi">+{% block content %}</span>
<span class="gi">+&lt;p&gt;Edit a flavour:&lt;/p&gt;</span>
<span class="gi">+</span>
<span class="gi">+&lt;form method=&quot;POST&quot;&gt;</span>
<span class="gi">+  {% csrf_token %}</span>
<span class="gi">+  &lt;p&gt;Name: &lt;input type=&quot;text&quot; name=&quot;name&quot; value=&quot;{{ flavour.name }}&quot; /&gt;&lt;/p&gt;</span>
<span class="gi">+  &lt;p&gt;Litres: &lt;input type=&quot;text&quot; name=&quot;litres&quot; value=&quot;{{ flavour.litres }}&quot; /&gt;&lt;/p&gt;</span>
<span class="gi">+  &lt;p&gt;Selling price: &lt;input type=&quot;text&quot; name=&quot;sellprice&quot; value=&quot;{{ flavour.sellprice }}&quot; /&gt;&lt;/p&gt;</span>
<span class="gi">+  &lt;p&gt;&lt;input type=&quot;submit&quot; value=&quot;Update&quot; /&gt;&lt;/p&gt;</span>
<span class="gi">+&lt;/form&gt;</span>
<span class="gi">+</span>
<span class="gi">+&lt;p&gt;&lt;a href=&quot;{% url &#39;icecream.views.flavour_delete&#39; flavour.id %}&quot;&gt;Delete&lt;/a&gt;&lt;/p&gt;</span>
<span class="gi">+</span>
<span class="gi">+&lt;p&gt;&lt;a href=&quot;..&quot;&gt;Back&lt;/a&gt;&lt;/p&gt;</span>
<span class="gi">+{% endblock %}</span>
<span class="gi">+</span>
<span class="gh">diff -u templates-old/icecream/flavours.html templates/icecream/flavours.html</span>
<span class="gd">--- templates-old/icecream/flavours.html</span>
<span class="gi">+++ templates/icecream/flavours.html</span>
<span class="gu">@@ -9,7 +9,7 @@</span>
 {% if flavours %}
   &lt;ul&gt;
     {% for flavour in flavours %}
<span class="gd">-    &lt;li&gt;{{ flavour.id }}: {{ flavour.name }}, {{ flavour.litres }}, {{ flavour.sellprice }}&lt;/li&gt;</span>
<span class="gi">+    &lt;li&gt;&lt;a href=&quot;{% url &#39;icecream.views.flavour_edit&#39; flavour.id %}&quot;&gt;{{ flavour.name }}&lt;/a&gt;: {{ flavour.litres }}, {{ flavour.sellprice }}&lt;/li&gt;</span>
     {% endfor %}
   &lt;/ul&gt;
 {% else %}
</pre></div>
</div>
<p>You should now be able to modify and save the details of each flavour.</p>
<p>This code is somewhat similar to adding and deleting flavours: For a GET request, we fetch the right model instance, and send it to the template for populating the form.  For a POST request, we fetch the right model instance, take the values from the <tt class="docutils literal"><span class="pre">request.POST</span></tt> dictionary, and plug them into the instance.  Finally we save the model instance, and redirect back to the main flavours page.</p>
</div>
<div class="section" id="using-django-s-forms">
<h2>Using Django&#8217;s forms<a class="headerlink" href="#using-django-s-forms" title="Permalink to this headline">¶</a></h2>
<p>It&#8217;s a bit tedious typing the details of a model into every form.  Let&#8217;s upgrade the code to use Django&#8217;s <tt class="docutils literal"><span class="pre">ModelForm</span></tt> form support:</p>
<div class="highlight-diff"><div class="highlight"><pre><span class="gh">diff -u icecream-old/forms.py icecream/forms.py</span>
<span class="gd">--- /dev/null</span>
<span class="gi">+++ icecream/forms.py</span>
<span class="gu">@@ -0,0 +1,6 @@</span>
<span class="gi">+from django.forms import ModelForm</span>
<span class="gi">+from icecream.models import Flavour</span>
<span class="gi">+</span>
<span class="gi">+class FlavourForm(ModelForm):</span>
<span class="gi">+    class Meta:</span>
<span class="gi">+        model = Flavour</span>
<span class="gh">diff -u icecream-old/views.py icecream/views.py</span>
<span class="gd">--- icecream-old/views.py</span>
<span class="gi">+++ icecream/views.py</span>
<span class="gu">@@ -4,6 +4,7 @@ from django.http import HttpResponseRedirect</span>
 from django.core.urlresolvers import reverse

 from icecream.models import Flavour
<span class="gi">+from icecream.forms import FlavourForm</span>

 def flavours(request):
     flavours = Flavour.objects.all()
<span class="gu">@@ -11,28 +12,28 @@ def flavours(request):</span>

 def flavour_add(request):
     if request.method == &#39;POST&#39;:
<span class="gd">-        flavour = Flavour()</span>
<span class="gd">-        flavour.name = request.POST[&#39;name&#39;]</span>
<span class="gd">-        flavour.litres = request.POST[&#39;litres&#39;]</span>
<span class="gd">-        flavour.sellprice = request.POST[&#39;sellprice&#39;]</span>
<span class="gi">+        form = FlavourForm(request.POST)</span>
<span class="gi">+        if form.is_valid():</span>
<span class="gi">+            form.save()</span>

<span class="gd">-        flavour.save()</span>
<span class="gi">+            return HttpResponseRedirect(reverse(&#39;icecream.views.flavours&#39;))</span>
<span class="gi">+    else:</span>
<span class="gi">+        form = FlavourForm()</span>

<span class="gd">-        return HttpResponseRedirect(reverse(&#39;icecream.views.flavours&#39;)) # Redirect after POST</span>
<span class="gd">-</span>
<span class="gd">-    return render_to_response(&#39;icecream/flavour-add.html&#39;, {}, context_instance=RequestContext(request))</span>
<span class="gi">+    return render_to_response(&#39;icecream/flavour-add.html&#39;, {&#39;form&#39;: form}, context_instance=RequestContext(request))</span>

 def flavour_edit(request, id):
     flavour = get_object_or_404(Flavour, pk=id)
     if request.method == &#39;POST&#39;:
<span class="gd">-        flavour.name = request.POST[&#39;name&#39;]</span>
<span class="gd">-        flavour.litres = request.POST[&#39;litres&#39;]</span>
<span class="gd">-        flavour.sellprice = request.POST[&#39;sellprice&#39;]</span>
<span class="gd">-        flavour.save()</span>
<span class="gi">+        form = FlavourForm(request.POST, instance=flavour)</span>
<span class="gi">+        if form.is_valid():</span>
<span class="gi">+            form.save()</span>

<span class="gd">-        return HttpResponseRedirect(reverse(&#39;icecream.views.flavours&#39;))</span>
<span class="gi">+            return HttpResponseRedirect(reverse(&#39;icecream.views.flavours&#39;))</span>
<span class="gi">+    else:</span>
<span class="gi">+        form = FlavourForm(instance=flavour) # bound form, loaded with data from the db</span>

<span class="gd">-    return render_to_response(&#39;icecream/flavour-edit.html&#39;, {&#39;flavour&#39;: flavour}, context_instance=RequestContext(request))</span>
<span class="gi">+    return render_to_response(&#39;icecream/flavour-edit.html&#39;, {&#39;flavour&#39;: flavour, &#39;form&#39;: form}, context_instance=RequestContext(request))</span>

 def flavour_delete(request, id):
     # GET: Prompt for whether to delete a flavour
<span class="gh">diff -u templates-old/icecream/flavour-add.html templates/icecream/flavour-add.html</span>
<span class="gd">--- templates-old/icecream/flavour-add.html</span>
<span class="gi">+++ templates/icecream/flavour-add.html</span>
<span class="gu">@@ -5,9 +5,7 @@</span>

 &lt;form method=&quot;POST&quot;&gt;
   {% csrf_token %}
<span class="gd">-  &lt;p&gt;Name: &lt;input type=&quot;text&quot; name=&quot;name&quot; value=&quot;&quot; /&gt;&lt;/p&gt;</span>
<span class="gd">-  &lt;p&gt;Litres: &lt;input type=&quot;text&quot; name=&quot;litres&quot; value=&quot;&quot; /&gt;&lt;/p&gt;</span>
<span class="gd">-  &lt;p&gt;Selling price: &lt;input type=&quot;text&quot; name=&quot;sellprice&quot; value=&quot;&quot; /&gt;&lt;/p&gt;</span>
<span class="gi">+  {{ form.as_p }}</span>
   &lt;p&gt;&lt;input type=&quot;submit&quot; value=&quot;Add&quot; /&gt;&lt;/p&gt;
 &lt;/form&gt;

<span class="gh">diff -u templates-old/icecream/flavour-edit.html templates/icecream/flavour-edit.html</span>
<span class="gd">--- templates-old/icecream/flavour-edit.html</span>
<span class="gi">+++ templates/icecream/flavour-edit.html</span>
<span class="gu">@@ -6,9 +6,7 @@</span>

 &lt;form method=&quot;POST&quot;&gt;
   {% csrf_token %}
<span class="gd">-  &lt;p&gt;Name: &lt;input type=&quot;text&quot; name=&quot;name&quot; value=&quot;{{ flavour.name }}&quot; /&gt;&lt;/p&gt;</span>
<span class="gd">-  &lt;p&gt;Litres: &lt;input type=&quot;text&quot; name=&quot;litres&quot; value=&quot;{{ flavour.litres }}&quot; /&gt;&lt;/p&gt;</span>
<span class="gd">-  &lt;p&gt;Selling price: &lt;input type=&quot;text&quot; name=&quot;sellprice&quot; value=&quot;{{ flavour.sellprice }}&quot; /&gt;&lt;/p&gt;</span>
<span class="gi">+  {{ form.as_p }}</span>
   &lt;p&gt;&lt;input type=&quot;submit&quot; value=&quot;Update&quot; /&gt;&lt;/p&gt;
 &lt;/form&gt;
</pre></div>
</div>
<p>A <tt class="docutils literal"><span class="pre">ModelForm</span></tt> is a subclass of Form that automates many aspects of forms:</p>
<blockquote>
<div><ul class="simple">
<li>The form fields are auto-pulled from the model.</li>
<li>The form fields can be populated by a model instance.</li>
<li>A model instance can be updated from form fields.</li>
<li>Data validation is done against the types of fields in the model.</li>
</ul>
</div></blockquote>
<p>Like the <tt class="docutils literal"><span class="pre">Form</span></tt> class, the form can be rendered in the template using <tt class="docutils literal"><span class="pre">{{</span> <span class="pre">form.as_p</span> <span class="pre">}}</span></tt>.</p>
<p>How does the ModelForm know which Model to use?  In <tt class="docutils literal"><span class="pre">forms.py</span></tt> we define FlavourForm as a subclass of ModelForm, then we define an inner class called Meta, and give that class an attribute called model, which we initialise to Flavour:</p>
<div class="highlight-py"><div class="highlight"><pre><span class="k">class</span> <span class="nc">FlavourForm</span><span class="p">(</span><span class="n">ModelForm</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Flavour</span>
</pre></div>
</div>
<p>One thing missing from the official Django tutorial is an explanation of how the form initially gets its values from the model instance, and how the model instance can be updated from the POST data.  The secret is the <tt class="docutils literal"><span class="pre">instance</span></tt> argument to the FlavourForm constructor.</p>
<p>Let&#8217;s look at the three cases where FlavourForm is instantiated:</p>
<blockquote>
<div><ul>
<li><p class="first">The first case is in the <tt class="docutils literal"><span class="pre">flavour_add()</span></tt> function:</p>
<div class="highlight-py"><div class="highlight"><pre><span class="n">form</span> <span class="o">=</span> <span class="n">FlavourForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>
</pre></div>
</div>
<p>There is no <tt class="docutils literal"><span class="pre">initial</span></tt> argument, but the constructor is passed a dictionary of POST data.  In this case, a new form is created with the form fields populated from the POST data.  Not only that, but it also creates a new internal model instance.  Calling the form&#8217;s <tt class="docutils literal"><span class="pre">save()</span></tt> function also calls the model instance&#8217;s <tt class="docutils literal"><span class="pre">save()</span></tt> method.  This is useful when you want to create a new instance from form data, but the form data should be cleaned and validated first.</p>
</li>
<li><p class="first">The second case is where the constructor is passed an <tt class="docutils literal"><span class="pre">instance</span></tt> argument but no POST data dictionary, such as in <tt class="docutils literal"><span class="pre">flavour_edit()</span></tt>:</p>
<div class="highlight-py"><div class="highlight"><pre><span class="n">form</span> <span class="o">=</span> <span class="n">FlavourForm</span><span class="p">(</span><span class="n">instance</span><span class="o">=</span><span class="n">flavour</span><span class="p">)</span>
</pre></div>
</div>
<p>In this case, the form&#8217;s fields are initialised from the <tt class="docutils literal"><span class="pre">instance</span></tt> model instance.  The form and fields can then be passed to the template for display.</p>
</li>
<li><p class="first">The third case is where the constructor is passed a dictionary of POST data, <em>and</em> an <tt class="docutils literal"><span class="pre">instance</span></tt> argument:</p>
<div class="highlight-py"><div class="highlight"><pre><span class="n">form</span> <span class="o">=</span> <span class="n">FlavourForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="n">flavour</span><span class="p">)</span>
</pre></div>
</div>
<p>In this case, the form remembers the model instance, and updates that model instance&#8217;s fields from the POST data.  This form can then be saved, which also saves the model instance.</p>
</li>
</ul>
</div></blockquote>
<p>Take careful note of the structure of the <tt class="docutils literal"><span class="pre">flavour_edit()</span></tt> function, as it&#8217;s a very common pattern.  Basically, we&#8217;re trying to handle four different scenarios:</p>
<p>GET or POST request, but with an invalid object (for example, no object with the given id):</p>
<blockquote>
<div>Throw a 404 exception; <em>or</em></div></blockquote>
<p>GET request:</p>
<blockquote>
<div>Retrieve model instance, create form using that instance, then pass the form to the template for rendering; <em>or</em></div></blockquote>
<p>POST request, with valid object, but invalid data:</p>
<blockquote>
<div>Retrieve the model instance, and create the form using that instance, but take the data from the POST dictionary.  Then pass the form to the template for rendering.  This allows the user to correct data they already typed; <em>or</em></div></blockquote>
<p>POST request, with valid object and data:</p>
<blockquote>
<div>Retrieve the model instance, and create the form using that instance.  Then update the fields of that instance using the POST dictionary.  Finally, save the form, which in turn saves the updated data in the model instance.</div></blockquote>
<p>This pattern shows the most graceful way of handling these four cases.</p>
</div>
<div class="section" id="multiple-actions">
<h2>Multiple actions<a class="headerlink" href="#multiple-actions" title="Permalink to this headline">¶</a></h2>
<p>Having a view respond to both GET and POST requests isn&#8217;t the only way of writing Django views, but it&#8217;s a common way.  It conveniently groups the marshalling of information (GET request action) with the processing of that information (POST request action).  It may be though that a given web page presents several possible actions to the user.  If this GET/POST pattern is used, then it may be necessary for the POST part of the view to handle several separate actions.  This is usually done by having the form pass back some kind of <tt class="docutils literal"><span class="pre">action</span></tt> variable which the POST handler can look at and act on.  One way of rewriting <tt class="docutils literal"><span class="pre">flavour_edit()</span></tt> to handle multiple actions would be to replace the <tt class="docutils literal"><span class="pre">form.save()</span></tt> code with something that checked the value of <tt class="docutils literal"><span class="pre">request.POST['action']</span></tt>, and executed code conditionally depending on that value.</p>
</div>
<div class="section" id="validation">
<h2>Validation<a class="headerlink" href="#validation" title="Permalink to this headline">¶</a></h2>
<p>One benefit of using Django&#8217;s forms over rolling our own is that Django can perform some validation automatically.  For example, since <tt class="docutils literal"><span class="pre">Flavour.litres</span></tt> is a <tt class="docutils literal"><span class="pre">FloatField</span></tt>, entering a string into this form field would cause <tt class="docutils literal"><span class="pre">form.is_valid()</span></tt> to return FALSE, which prevents this invalid data from being saved to the database.  Not only that, <tt class="docutils literal"><span class="pre">is_valid()</span></tt> also marks fields that have invalid data, so that when the form is rendered, an error message is displayed next to fields with invalid data.</p>
<p>This kind of validation can only help catch type errors in model fields - it knows nothing about what values make sense to your application.  However you can add validation to your form code to do such validation.  For more information, see Django&#8217;s forms documentation.</p>
</div>
<div class="section" id="field-help">
<h2>Field Help<a class="headerlink" href="#field-help" title="Permalink to this headline">¶</a></h2>
<p>Our app now supports all four CRUD operations, and displays model data fields in forms.  But it would be better to give our users some advice about how the fields are used.  Let&#8217;s change our code to provide some help text to the user:</p>
<div class="highlight-diff"><div class="highlight"><pre><span class="gh">diff -u icecream-old/models.py icecream/models.py</span>
<span class="gd">--- icecream-old/models.py</span>
<span class="gi">+++ icecream/models.py</span>
<span class="gu">@@ -3,8 +3,8 @@ from django.db import models</span>
 # Create your models here.
 class Flavour(models.Model):
     name = models.CharField(max_length=40)
<span class="gd">-    litres = models.FloatField() # How many litres we have in the store</span>
<span class="gd">-    sellprice = models.DecimalField(decimal_places=2, max_digits=5) # How much it costs per litre</span>
<span class="gi">+    litres = models.FloatField(help_text=&quot;How many litres do we have in the store?&quot;)</span>
<span class="gi">+    sellprice = models.DecimalField(decimal_places=2, max_digits=5, help_text=&quot;How much per litre?&quot;) #</span>

     def __unicode__(self):
         return self.name
</pre></div>
</div>
<p>Now the page to add a page should also show some field help.</p>
<p>This text is also shown to users when they use the admin interface.  Try adding a flavour!</p>
</div>
<div class="section" id="plural-nouns">
<h2>Plural nouns<a class="headerlink" href="#plural-nouns" title="Permalink to this headline">¶</a></h2>
<p>Let&#8217;s say our shop is having a promotion: Half price for your favourite flavour!  To support this, we need to create a model for people and what kind of icecream they like:</p>
<div class="highlight-diff"><div class="highlight"><pre><span class="gh">diff -u icecream-old/models.py icecream/models.py</span>
<span class="gd">--- icecream-old/models.py</span>
<span class="gi">+++ icecream/models.py</span>
<span class="gu">@@ -9,3 +9,9 @@ class Flavour(models.Model):</span>
     def __unicode__(self):
         return self.name

<span class="gi">+class Person(models.Model):</span>
<span class="gi">+    name = models.CharField(max_length=60)</span>
<span class="gi">+    favourite_flavour = models.ForeignKey(Flavour)</span>
<span class="gi">+</span>
<span class="gi">+    def __unicode__(self):</span>
<span class="gi">+        return self.name</span>
<span class="gh">diff -u icecream-old/admin.py icecream/admin.py</span>
<span class="gd">--- icecream-old/admin.py</span>
<span class="gi">+++ icecream/admin.py</span>
<span class="gu">@@ -1,9 +1,14 @@</span>
 from django.contrib import admin
<span class="gd">-from icecream.models import Flavour</span>
<span class="gi">+from icecream.models import Flavour, Person</span>

 # Override fields and ordering of fields
 class FlavourAdmin(admin.ModelAdmin):
     fields = [&#39;name&#39;, &#39;litres&#39;, &#39;sellprice&#39;]
     list_display = (&#39;name&#39;, &#39;litres&#39;, &#39;sellprice&#39;)

<span class="gi">+class PersonAdmin(admin.ModelAdmin):</span>
<span class="gi">+    fields = [&#39;name&#39;, &#39;favourite_flavour&#39;]</span>
<span class="gi">+    list_display = (&#39;name&#39;, &#39;favourite_flavour&#39;)</span>
<span class="gi">+</span>
 admin.site.register(Flavour, FlavourAdmin)
<span class="gi">+admin.site.register(Person, PersonAdmin)</span>
</pre></div>
</div>
<p>Well that&#8217;s fine, but then the admin interface starts talking about &#8220;Persons&#8221; instead of &#8220;People&#8221;.  To correct this, we need to teach Django what the plural of Person is:</p>
<div class="highlight-diff"><div class="highlight"><pre><span class="gh">diff -u icecream-old/models.py icecream/models.py</span>
<span class="gd">--- icecream-old/models.py</span>
<span class="gi">+++ icecream/models.py</span>
<span class="gu">@@ -15,3 +15,6 @@ class Person(models.Model):</span>

     def __unicode__(self):
         return self.name
<span class="gi">+</span>
<span class="gi">+    class Meta:</span>
<span class="gi">+        verbose_name_plural = &quot;People&quot;</span>
</pre></div>
</div>
<p>Now try adding a person to the database.  What happens?  Ahh, DatabaseError, because we forgot to create the table.  Run this shell command to create the <tt class="docutils literal"><span class="pre">icecream_person</span></tt> table:</p>
<div class="highlight-bash"><div class="highlight"><pre>python manage.py syncdb
</pre></div>
</div>
<p>People editing now works fine!</p>
</div>
<div class="section" id="displaying-result-messages">
<h2>Displaying result messages<a class="headerlink" href="#displaying-result-messages" title="Permalink to this headline">¶</a></h2>
<p>Three of the CRUD operations (create, update and delete) change data.  Sometimes our attempts might succeed, and sometimes they might fail.  Let&#8217;s give our users a way of knowing whether something worked or not.</p>
<div class="highlight-diff"><div class="highlight"><pre><span class="gh">diff -u icecream-old/views.py icecream/views.py</span>
<span class="gd">--- icecream-old/views.py</span>
<span class="gi">+++ icecream/views.py</span>
<span class="gu">@@ -2,13 +2,14 @@ from django.shortcuts import render_to_response, get_object_or_404</span>
 from django.template import RequestContext
 from django.http import HttpResponseRedirect
 from django.core.urlresolvers import reverse
<span class="gi">+from django.contrib import messages</span>

 from icecream.models import Flavour
 from icecream.forms import FlavourForm

 def flavours(request):
     flavours = Flavour.objects.all()
<span class="gd">-    return render_to_response(&#39;icecream/flavours.html&#39;, {&#39;flavours&#39;: flavours})</span>
<span class="gi">+    return render_to_response(&#39;icecream/flavours.html&#39;, {&#39;flavours&#39;: flavours}, context_instance=RequestContext(request))</span>

 def flavour_add(request):
     if request.method == &#39;POST&#39;:
<span class="gu">@@ -16,7 +17,11 @@ def flavour_add(request):</span>
         if form.is_valid():
             form.save()

<span class="gi">+            messages.success(request, &quot;Flavour added.&quot;)</span>
<span class="gi">+</span>
             return HttpResponseRedirect(reverse(&#39;icecream.views.flavours&#39;))
<span class="gi">+</span>
<span class="gi">+        messages.error(request, &quot;The data is not valid, so the new flavour was not added.&quot;)</span>
     else:
         form = FlavourForm()

<span class="gu">@@ -29,7 +34,11 @@ def flavour_edit(request, id):</span>
         if form.is_valid():
             form.save()

<span class="gi">+            messages.success(request, &quot;Flavour changed.&quot;)</span>
<span class="gi">+</span>
             return HttpResponseRedirect(reverse(&#39;icecream.views.flavours&#39;))
<span class="gi">+</span>
<span class="gi">+        messages.error(request, &quot;The data is not valid, so the flavour was not updated.&quot;)</span>
     else:
         form = FlavourForm(instance=flavour) # bound form, loaded with data from the db

<span class="gu">@@ -43,6 +52,8 @@ def flavour_delete(request, id):</span>
     if request.method == &#39;POST&#39;:
         flavour.delete()

<span class="gi">+        messages.success(request, &quot;Flavour deleted.&quot;)</span>
<span class="gi">+</span>
         return HttpResponseRedirect(reverse(&#39;icecream.views.flavours&#39;))

     return render_to_response(&#39;icecream/flavour-delete.html&#39;, {&#39;flavour&#39;: flavour}, context_instance=RequestContext(request))
<span class="gh">diff -u templates-old/base.html templates/base.html</span>
<span class="gd">--- templates-old/base.html</span>
<span class="gi">+++ templates/base.html</span>
<span class="gu">@@ -4,6 +4,14 @@</span>
     &lt;title&gt;{% block title %}icecream.com: Nirvana for icecream lovers{% endblock %}&lt;/title&gt;
   &lt;/head&gt;
   &lt;body&gt;
<span class="gi">+    {% if messages %}</span>
<span class="gi">+      &lt;h2&gt;Messages&lt;/h2&gt;</span>
<span class="gi">+      &lt;ul class=&quot;messages&quot;&gt;</span>
<span class="gi">+        {% for message in messages %}</span>
<span class="gi">+          &lt;li&gt;&lt;i&gt;{{ message }}&lt;/i&gt;&lt;/li&gt;</span>
<span class="gi">+        {% endfor %}</span>
<span class="gi">+      &lt;/ul&gt;</span>
<span class="gi">+    {% endif %}</span>
     &lt;h1&gt;{% block header %}Nirvana for icecream lovers{% endblock %}&lt;/h1&gt;
     {% block content %}{% endblock %}
     {% block footer %}
</pre></div>
</div>
<p>One advantage of template inheritance is that this gives us one place where we can take care of displaying messages.</p>
</div>
</div>
<div class="section" id="summary">
<h1>Summary<a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h1>
<p>Django gives us:</p>
<blockquote>
<div><ul class="simple">
<li>A cross-platform, cross-database way of writing web-based CRUD apps, and</li>
<li>A free admin interface for staff</li>
</ul>
</div></blockquote>
<p>In general, the plan for writing a Django app goes:</p>
<blockquote>
<div><ul class="simple">
<li>Define models</li>
<li>Make a URL plan</li>
<li>Map URLs to views</li>
<li>Write views, map to templates</li>
<li>Write templates</li>
</ul>
</div></blockquote>
<p>This also applies to adding functionality to existing apps.</p>
<p>And Django has hundreds of other plugins, such as:</p>
<blockquote>
<div><ul class="simple">
<li>Database schema migrations</li>
<li>Security and authentication</li>
</ul>
</div></blockquote>
<p>Thanks for following this tutorial!</p>
</div>
<div class="section" id="indices-and-tables">
<h1>Indices and tables<a class="headerlink" href="#indices-and-tables" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li><a class="reference internal" href="genindex.html"><em>Index</em></a></li>
<li><a class="reference internal" href="py-modindex.html"><em>Module Index</em></a></li>
<li><a class="reference internal" href="search.html"><em>Search Page</em></a></li>
</ul>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="#">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Welcome to the Django icecream tutorial!</a></li>
<li><a class="reference internal" href="#getting-started">Getting started</a><ul>
</ul>
</li>
<li><a class="reference internal" href="#tutorial">Tutorial</a><ul>
<li><a class="reference internal" href="#creating-the-project">Creating the project</a></li>
<li><a class="reference internal" href="#making-icecream">Making icecream</a></li>
<li><a class="reference internal" href="#playing-with-flavours">Playing with flavours</a></li>
<li><a class="reference internal" href="#flavours-in-admin">Flavours in admin</a></li>
<li><a class="reference internal" href="#crud-is-create-read-update-and-delete">CRUD is Create, Read, Update and Delete</a></li>
<li><a class="reference internal" href="#url-and-view-design">URL and view design</a></li>
<li><a class="reference internal" href="#show-a-list-of-flavours">Show a list of flavours</a></li>
<li><a class="reference internal" href="#template-inheritance">Template Inheritance</a></li>
<li><a class="reference internal" href="#fields-in-templates">Fields in templates</a></li>
<li><a class="reference internal" href="#conditionals-in-templates">Conditionals in templates</a></li>
<li><a class="reference internal" href="#adding-an-add-link">Adding an &#8216;Add&#8217; link</a></li>
<li><a class="reference internal" href="#using-the-url-tag">Using the <tt class="docutils literal"><span class="pre">url</span></tt> tag</a></li>
<li><a class="reference internal" href="#adding-an-add-form-and-view">Adding an &#8220;Add&#8221; form and view</a></li>
<li><a class="reference internal" href="#csrf-and-adding-flavours">CSRF and adding flavours</a></li>
<li><a class="reference internal" href="#adding-delete">Adding delete</a></li>
<li><a class="reference internal" href="#editing-flavours">Editing flavours</a></li>
<li><a class="reference internal" href="#using-django-s-forms">Using Django&#8217;s forms</a></li>
<li><a class="reference internal" href="#multiple-actions">Multiple actions</a></li>
<li><a class="reference internal" href="#validation">Validation</a></li>
<li><a class="reference internal" href="#field-help">Field Help</a></li>
<li><a class="reference internal" href="#plural-nouns">Plural nouns</a></li>
<li><a class="reference internal" href="#displaying-result-messages">Displaying result messages</a></li>
</ul>
</li>
<li><a class="reference internal" href="#summary">Summary</a></li>
<li><a class="reference internal" href="#indices-and-tables">Indices and tables</a></li>
</ul>

  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/index.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li><a href="#">icecream 0.1 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, Mitch Davis.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>